<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login</title>

  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

  <script src="assets/app-core.js"></script>
  <script src="assets/acl-guard.js"></script>

  <link rel="stylesheet" href="assets/style.css" />
</head>

<body>

  <div class="container">
    <h2>Login</h2>

    <input id="loginEmail" type="email" placeholder="Email" />
    <input id="loginPass" type="password" placeholder="Password" />

    <button id="btnLogin">Enter</button>
    <button id="btnLogout">Logout</button>

    <div id="loginMsg"></div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const loginEmail = document.getElementById("loginEmail");
  const loginPass  = document.getElementById("loginPass");
  const btnLogin   = document.getElementById("btnLogin");
  const btnLogout  = document.getElementById("btnLogout");
  const loginMsg   = document.getElementById("loginMsg");

  function setMsg(msg, type="") {
    loginMsg.textContent = msg;
    loginMsg.className = type;
  }

  // ===========================
  // LOGIN
  // ===========================

  if (btnLogin) {
    btnLogin.addEventListener("click", async () => {

      if (!window.netlifyIdentity) {
        setMsg("Netlify Identity is not available on this page.", "error");
        return;
      }

      const email = loginEmail.value.trim();
      const pass  = loginPass.value.trim();

      if (!email || !pass) {
        setMsg("Please enter email and password.", "error");
        return;
      }

      try {
        await window.netlifyIdentity.login(email, pass);

        const user = window.netlifyIdentity.currentUser();
        if (!user) {
          setMsg("Login failed.", "error");
          return;
        }

        // salva sessÃ£o local
        anwSave("anw_session", { email });

        setMsg("Login successful.", "success");

        setTimeout(() => {
          window.location.href = "dashboard.html";
        }, 600);

      } catch (err) {
        setMsg(err.message || "Login error.", "error");
      }

    });
  }

  // ===========================
  // LOGOUT
  // ===========================

  if (btnLogout) {
    btnLogout.addEventListener("click", async () => {
      try {
        window.netlifyIdentity.logout();
      } catch {}

      localStorage.removeItem("anw_session");
      loginPass.value = "";
      setMsg("You have been logged out.", "info");
    });
  }

});
</script>

</body>
</html>
